generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Users {
  id         Int       @id @unique @default(autoincrement())
  name       String
  email      String    @unique
  password   String
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  role       String
  Tickets    Tickets[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Movies {
  id         Int      @id(map: "Movie_pkey") @default(autoincrement())
  title      String
  year       Int      @db.SmallInt
  rated      String
  released   String
  genre      String[]
  cast       String[]
  director   String
  runtime    Int      @db.SmallInt
  plot       String
  language   String
  poster     String
  status     String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  Shows      Shows[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Shows {
  id              Int       @id @default(autoincrement())
  movie           Int
  date            DateTime  @db.Date
  time            DateTime  @db.Time(6)
  status          String
  available_seats String[]
  sold_seats      String[]
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  price           Int       @db.SmallInt
  Movies          Movies    @relation(fields: [movie], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Tickets         Tickets[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Tickets {
  id              Int      @id @default(autoincrement())
  show            Int
  user            Int
  seats           String[]
  number_of_seats Int      @db.SmallInt
  seat_price      Int      @db.SmallInt
  discount        Int?     @default(0) @db.SmallInt
  total           Int      @default(dbgenerated("(number_of_seats * seat_price)"))
  grand_total     Int      @default(dbgenerated("((number_of_seats * seat_price) - COALESCE((discount)::integer, 0))"))
  status          String
  payment         String
  Shows           Shows    @relation(fields: [show], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Users           Users    @relation(fields: [user], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
